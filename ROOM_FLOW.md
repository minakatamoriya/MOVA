# 房间流程设计文档

## 总览

Roguelike 地图分支系统，共 10 层（不含起点），30 张地图分布在 3 条主线 + 中立区。

---

## 流程图

```
命运十字（起点，选武器）
    │
    ▼
第1层 ─ 三选一（三条主线各出1张，决定初始路线）
    │       🌿 狩猎之道 ─ 晨曦林地 / 风语森林
    │       🔮 秘法之境 ─ 禁书藏馆 / 奥术高塔
    │       ⚔️ 征战之途 ─ 钢铁要塞 / 血染斗技场
    ▼
第2层 ─ 三选一（当前主线2张 + 跨线节点1张）
    ▼
第3层 ─ 三选一（当前主线2张 + 跨线节点1张）
    ▼
第4层 ─ 三选一（当前主线3张）
    ▼
第5层 ─ 三选一（当前主线2张 + 跨线节点1张）
    ▼
第6层 ─ 三选一（当前主线3张）
    ▼
第7层 ─ 三选一（当前主线2张 + 跨线节点1张）
    ▼
第8层 ─ 三选一（当前主线2张 + 跨线节点1张）
    ▼
第9层 ─ 混沌前厅（固定，单门直通）
    ▼
第10层─ 混沌王座（固定，最终 Boss）
```

---

## 单关流程

```
进入地图
    │
    ├─ 地图名称显示在小地图上方
    ├─ 根据 mapMonsters.js 刷怪（小怪3种 + 精英2种）
    │
    ▼
玩家探索 & 击杀小怪/精英
    │
    ├─ 接近 Boss 区域 → Boss 激活（名称 + 血条 + 弹幕）
    │       Boss 来自 mapMonsters.js 对应地图的 boss 条目
    │
    ▼
击杀 Boss
    │
    ├─ 推进 currentStage + 1
    ├─ 查询 STAGE_FLOW[currentStage]
    │
    ├─ type='intro' 或 'choice' → 地图顶部出现三扇门
    │       每扇门显示：地图名 + 副标题
    │       门框颜色 = 线路颜色（🌿绿/🔮蓝/⚔️红/🕯️灰）
    │       玩家走入任一门 → 选择该地图 → 闪白过渡 → 下一关
    │
    ├─ type='fixed' → 单一出口门 → 直通固定地图
    │
    └─ 超出10层 → 游戏结束
```

---

## 三条主线

| 线路 | 标识 | emoji | 颜色 | 地图数 |
|------|------|-------|------|--------|
| 狩猎之道 | `hunt` | 🌿 | `#44aa44` | 8 |
| 秘法之境 | `arcane` | 🔮 | `#6666dd` | 8 |
| 征战之途 | `war` | ⚔️ | `#cc4444` | 8 |
| 中立/跨线 | `neutral` | 🕯️ | `#999999` | 3 |
| 特殊固定 | — | — | — | 3 |

---

## 完整地图 & 怪物表

### 🌿 狩猎之道

| 地图 | 小怪 | 精英 | Boss |
|------|------|------|------|
| 晨曦林地 | 晨光蝶、树苗守卫、疾风斥候 | 古老树精、黎明守卫 | 黎明鹿王·艾尔文 |
| 风语森林 | 风精、疾风盗贼、旋风幼体 | 狂风使者、风暴追猎者 | 风语者·赛莲 |
| 幽光沼泽 | 沼泽蛞蝓、幽光蚊群、泥沼怪 | 剧毒潜伏者、幽光亡魂 | 沼泽之母·格蕾塔 |
| 兽王巢穴 | 巢穴幼兽、尖牙野狼、暗影豹 | 兽王亲卫、狂乱巨熊 | 兽王·卡恩 |
| 荆棘迷宫 | 荆棘藤蔓、迷宫刺球、毒刺花妖 | 荆棘编织者、铁刺守卫 | 迷宫之主·索恩 |
| 月影湖畔 | 月影幽魂、湖光幻妖、夜行猎手 | 暗月刺客、湖中女妖 | 月影女士·莱拉 |
| 翡翠庭院 | 翡翠守卫、生命之花妖、治愈守护灵 | 德鲁伊长老、翡翠龙兽 | 翡翠之母·维拉 |
| 苍翠穹顶 | 苍翠树精、穹顶之眼、自然之灵 | 远古守护者、苍翠幼龙 | 苍翠之魂·奥姆 |

### 🔮 秘法之境

| 地图 | 小怪 | 精英 | Boss |
|------|------|------|------|
| 禁书藏馆 | 活化书页、咒文守卫、魔法飞弹构造体 | 禁忌学者、咒术师 | 大图书馆长·莫比乌斯 |
| 奥术高塔 | 奥术学徒、魔力浮龙、元素侍从 | 高阶法师、奥术构造体 | 大法师·萨洛蒙 |
| 虚空回廊 | 虚空行者、暗影魔、召唤传送门 | 虚空吞噬者、暗影祭司 | 虚空领主·扎拉斯 |
| 魔力源泉 | 魔力水元素、法力浮灵、源泉守卫 | 魔力喷涌者、源泉守护者 | 魔力之泉·安努 |
| 元素王座 | 火元素、冰霜幼龙、雷击者 | 元素大使、混沌元素 | 四相元素聚合体 |
| 时空裂境 | 时空扭曲体、时间窃贼、空间裂隙兽 | 时间编织者、空间切割者 | 时空之主·柯罗诺斯 |
| 符文工坊 | 符文傀儡、附魔刀锋、活化符文 | 符文铁匠、符文守护者 | 大符文匠·托林 |
| 星辰穹殿 | 星界使徒、星辰幻影、陨石碎片 | 星辰预言者、穹顶守护者 | 星辰之主·阿斯特拉 |

### ⚔️ 征战之途

| 地图 | 小怪 | 精英 | Boss |
|------|------|------|------|
| 钢铁要塞 | 钢铁守卫、盾卫、弩炮手 | 铁壁骑士、要塞指挥官 | 钢铁领主·加雷特 |
| 血染斗技场 | 角斗士、血斗士、狂战士 | 血腥屠夫、斗技场冠军 | 鲜血之王·卡修斯 |
| 雷霆崖壁 | 雷霆蜥蜴、震地者、风暴之鹰 | 雷霆使者、崖壁萨满 | 雷霆之王·索尔 |
| 巨龙墓地 | 骨龙幼体、龙人守卫、墓穴蠕虫 | 龙魂骑士、墓穴巨龙 | 太古龙魂·奈萨里奥 |
| 烈风峡谷 | 烈风掠夺者、峡谷风蛇、冲锋骑兵 | 风骑士、峡谷领主 | 烈风之主·阿拉斯特 |
| 战神祭坛 | 战神圣像、狂热信徒、战争使者 | 战神祭祀、狂信者 | 战神化身·马尔斯 |
| 不朽王陵 | 骷髅战士、幽灵、尸妖 | 死亡骑士、不朽守卫 | 不朽之王·莱因哈特 |
| 荣光殿堂 | 英灵战士、荣耀守卫、瓦尔基里 | 英灵英雄、殿堂守护者 | 英灵王·奥丁森 |

### 🕯️ 中立/特殊

| 地图 | 小怪 | 精英 | Boss |
|------|------|------|------|
| 遗忘之墟 | 遗忘者、废墟爬行者、时间残渣 | 遗忘守卫、时空残响 | 遗忘之王·摩洛克 |
| 幻象迷宫 | 幻象复制体、迷宫守卫、幻影猎手 | 幻象编织者、迷宫牛头怪 | 迷宫之主·米诺陶斯 |
| 时空枢纽 | 时空守卫、时间执法者、空间监察者 | 时空撕裂者、枢纽守护者 | 时空之主·克罗米 |
| 混沌前厅 | 混沌仆从、虚空爪牙、前厅守卫 | 混沌祭司、前厅执政官 | 混沌守卫·卡奥斯 |
| 混沌王座 | 混沌魔物、暗影巨兽、王座之眼 | 混沌领主、深渊骑士 | 混沌之神·厄瑞波斯 |
| 命运十字 | （无常规小怪） | 命运之轮守护者（可选） | — |

---

## 层级选择规则

| 层 | 类型 | 规则 |
|----|------|------|
| 1 | intro | 三线各1张 layer=1 地图，玩家选择决定初始路线 |
| 2 | choice+跨线 | 当前主线2张 + 跨线节点1张 |
| 3 | choice+跨线 | 当前主线2张 + 跨线节点1张 |
| 4 | choice | 当前主线3张 |
| 5 | choice+跨线 | 当前主线2张 + 跨线节点1张 |
| 6 | choice | 当前主线3张 |
| 7 | choice+跨线 | 当前主线2张 + 跨线节点1张 |
| 8 | choice+跨线 | 当前主线2张 + 跨线节点1张 |
| 9 | fixed | 混沌前厅（固定地图，单门直通） |
| 10 | fixed | 混沌王座（最终Boss） |

---

## 怪物角色尺寸

| 角色 | 圆形半径 | 基础 HP（测试） | 名称颜色 |
|------|----------|-----------------|----------|
| 小怪 minion | 11 | 40 | 灰色 #cccccc |
| 精英 elite | 20 | 80 | 金色 #ffcc44 |
| Boss boss | 44 | 100 | 橙色 #ff8844 |

---

## 关键数据文件

| 文件 | 说明 |
|------|------|
| `src/data/mapPool.js` | 30张地图定义 + 10层流程 + 三选一抽取逻辑 |
| `src/data/mapMonsters.js` | 176个怪物定义（按地图分组） + 查询函数 |
| `src/data/mapEvents.js` | 地图事件池（框架就绪） |
| `src/data/mapDrops.js` | 地图掉落物池 |
